name: deployment
on:
  push:
    branches: [main]
jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - name: 'Checkout 🧞'
        uses: actions/checkout@v2
      - uses: oleksiyrudenko/gha-git-credentials@v2-latest
        with:
          token: ${{ secrets.SANDSTORM }}
      - name: Update Git Submodules
        run: |
          git submodule init
          git submodule update --remote --merge
      - name: Verify Changed files 🐒
        uses: tj-actions/verify-changed-files@v8.3
        id: verify-changed-files
        with:
          files: |
            .
      - name: commit & Push changes 💾
        if: steps.verify-changed-files.outputs.files_changed == 'true'
        run: |
          # Stage the file, commit and push
          git pull
          git add .
          git commit -m "Updated Submodules"
          git push origin main

      - name: Create PR, Commit & Push changes 💾
        id: cpr
        uses: peter-evans/create-pull-request@v3
        with:
          token: ${{ secrets.SANDSTORM }}
          commit-message: Update Submodule
          committer: GitHub <noreply@github.com>
          author: ${{ github.actor }} <${{ github.actor }}@users.noreply.github.com>
          signoff: false
          branch: blog-posts
          delete-branch: true
          title: 'Update Blog Posts Submodule'
          body: |
            Update Submodule
            - Updated with *today's* date
          labels: |
            blog posts
            automated pr
          assignees: lbugasu
          reviewers: lbugasu
          team-reviewers: |
            owners
          draft: false
