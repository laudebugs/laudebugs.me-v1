name: deployment
on:
  push:
    branches: [main]
  repository_dispatch:
    types: [posts_update]
jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - name: 'Checkout üßû'
        uses: actions/checkout@v2
      - uses: oleksiyrudenko/gha-git-credentials@v2-latest
        with:
          token: ${{ secrets.SANDSTORM }}
      - name: Update Git Submodules
        run: |
          git submodule init
          git submodule update --remote --merge
      - name: Verify Changed files üêí
        uses: tj-actions/verify-changed-files@v8.3
        id: verify-changed-files
        with:
          files: |
            .
      - name: Create PR, Commit & Push changes üíæ
        id: cpr
        if: steps.verify-changed-files.outputs.files_changed == 'true'
        uses: peter-evans/create-pull-request@v3
        with:
          token: ${{ secrets.SANDSTORM }}
          commit-message: Update Submodule
          committer: GitHub <noreply@github.com>
          author: ${{ github.actor }} <${{ github.actor }}@users.noreply.github.com>
          signoff: false
          branch: blog-posts
          branch-suffix: random
          delete-branch: true
          title: 'Update Blog Posts Submodule'
          body: |
            Update Submodule
            - Updated with Blog Posts
          labels: |
            blog posts
            automated pr
          assignees: lbugasu
          team-reviewers: |
            owners
          draft: false
      - name: Enable Pull Request Automerge
        if: steps.cpr.outputs.pull-request-operation == 'created'
        uses: peter-evans/enable-pull-request-automerge@v1
        with:
          token: ${{ secrets.SANDSTORM }}
          pull-request-number: ${{ steps.cpr.outputs.pull-request-number }}
          merge-method: squash
