name: deployment
on:
  repository_dispatch:
    types: [posts_update]
jobs:
  deploy:
    runs-on: ubuntu-latest
    permissions:
      pull-requests: write
      contents: write
    steps:
      - name: 'Checkout 🧞'
        uses: actions/checkout@v2
      - uses: oleksiyrudenko/gha-git-credentials@v2-latest
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
      - name: Update Git Submodules
        run: |
          git submodule init
          git submodule update --remote --merge
      - name: Verify Changed files 🐒
        uses: tj-actions/verify-changed-files@v8.8
        id: verify-changed-files
        with:
          files: |
            .
      - name: Create PR, Commit & Push changes 💾
        id: cpr
        if: steps.verify-changed-files.outputs.files_changed == 'true'
        uses: peter-evans/create-pull-request@v4
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
          commit-message: 'chore(update): ${{ github.event.client_payload.message.commit_sha }} [skip ci]'
          committer: GitHub <noreply@github.com>
          author: ${{ github.actor }} <${{ github.actor }}@users.noreply.github.com>
          signoff: false
          branch: blog-posts
          branch-suffix: random
          delete-branch: true
          title: 'chore(update): ${{ github.event.client_payload.message.commit_sha }} [skip ci]'
          body: |
            Update Submodule
            - Updated with Blog Posts
          labels: |
            blog posts archive
            ready for review
            automated pr
          assignees: laudebugs
          draft: false
